---
- name: 11) Run nginx container on Docker hosts
  hosts: docker_hosts:aws_hosts
  gather_facts: false

  tasks:
    - name: Ensure custom web root exists
      ansible.builtin.file:
        path: /opt/nginx-custom
        state: directory
        mode: "0755"

    - name: Write custom index.html
      ansible.builtin.copy:
        dest: /opt/nginx-custom/index.html
        content: |
          <h1>Hello from Ansible + Docker</h1>
          <p>host={{ inventory_hostname }}</p>
        mode: "0644"

    - name: Pull nginx image
      community.docker.docker_image:
        name: nginx
        source: pull

    - name: Run nginx container
      community.docker.docker_container:
        name: ansible-nginx
        image: nginx:latest
        state: started
        restart_policy: unless-stopped
        ports:
          - "8081:80"
        volumes:
          - /opt/nginx-custom:/usr/share/nginx/html:ro
